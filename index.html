<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>Game</title>
    <script src="http://code.jquery.com/jquery-1.5.min.js"></script>
    <script src="jgestures.min.js"  type="text/javascript"></script>
    <script src="http://code.jquery.com/mobile/1.0a3/jquery.mobile-1.0a3.min.js"></script>
    <link rel="stylesheet" type="text/css" href="controls.css" />
    <script type="text/javascript" src="controls.js"></script>
    <script type="text/javascript" src="additional.js"></script>
    <script type="text/javascript" src="classes.js"></script>
    <script type="text/javascript" src="createObjects.js"></script>
    <script type="text/javascript" src="draw.js"></script>
    <script type="text/javascript" src="enemy_ai.js"></script>
</head>
<body>

<script type="text/javascript">
    var i, j ,k;
    var bombsCounter = 0;
    firesCounter = 0;

    //Main field
    var element = document.createElement('div');
    element.setAttribute('id', 'field');
    element.style.position = "absolute";
    element.style.left = "0px";
    element.style.top = "0px";
    document.body.appendChild(element);

    //Bombs
    element = document.createElement('div');
    element.setAttribute('id', 'bombs');
    element.style.position = "absolute";
    element.style.left = "0px";
    element.style.top = "0px";
    document.getElementById("field").appendChild(element);

    //Background of the field

    var backGround = new Array();
    for (i = 0; i < numberOfTiles; ++i) {
        for (j = 0; j < numberOfTiles; ++j) {
            backGround.push(new BackgroundTile(i,j));
        }
    }


    //Block of the field
    var blocks = new Array();
    for (k = 0; k < 5; ++k) {
        i = getRandomInt(0, (sizeOfMap - sizeOfTile)/sizeOfTile);
        j = getRandomInt(0, (sizeOfMap - sizeOfTile)/sizeOfTile);
        blocks.push(new Block(i, j));
    }
    //Box
    var boxes = new Array();
    for (k = 0; k < 10; ++k) {
        i = getRandomInt(0, (sizeOfMap - sizeOfTile)/sizeOfTile);
        j = getRandomInt(0, (sizeOfMap - sizeOfTile)/sizeOfTile);
        boxes.push(new Box(i, j));
    }

    //Player
    var player = new Player(0, 0);

    player_go = false;
    player_go_x = 0;
    player_go_y = 0;

    //Enemy
    var enemy = new Enemy(5, 6);

    //Bombs
    var bombs = new Array();

    var fires = new Array();

    setInterval(function() {
        //clearDOM();
        //update(bombs);

        draw(player, bombs, fires, enemy);
        if (player_go) {
            var to_go = pathFind(player.x, player.y, player_go_x, player_go_y);
            if (to_go[2]) {
                player_go = false;
            } else {
                player.goTo(to_go[0], to_go[1]);
            }
        }
    }, 200);
    setInterval(function() {
        //clearDOM();
        //update(bombs);
        var to_go = pathFind(enemy.x, enemy.y, player.x, player.y);
        enemy.goTo(to_go[0], to_go[1]);


    }, 2000);


    $(document).ready(function() {
        jQuery('.left').bind('tapone',function(){
            goTo('left', 20, player);
        });

        jQuery('.right').bind('tapone',function(){
            goTo('right', 20, player);
        });

        jQuery('.top').bind('tapone',function(){
            goTo('top', 20, player);
        });

        jQuery('.bottom').bind('tapone',function(){
            goTo('bottom', 20, player);
        });
        jQuery('.bomb_creation').bind('click',function(){
            putBomb(bombs, player.getX(),player.getY(), ++bombsCounter, ++firesCounter)
        });
        jQuery(".partOfBackground").bind('tapone', function() {
            var contentPanelId = jQuery(this).attr("id");

            var pos = jQuery(this).position();
            //alert(pos.top + ', ' + pos.left);
            player_go = true;
            player_go_x = pos.left/sizeOfTile;
            player_go_y = pos.top/sizeOfTile;



        });


        //var p = $("p:first");
        //var position = currentId.position();

       // var pos = jQuery(currentId).position();
        //alert(pos.top + ', ' + pos.left);


        //$("p:last").text( "left: " + position.left + ", top: " + position.top );


    })
</script>

<div id="controls">
    <span class="left"></span>
    <span class="top"></span>
    <span class="bottom" ></span>
    <span class="right"></span>
</div>
<div style="position: absolute; top: 400px;">
    <input class="bomb_creation" type="button" value="Bomb">
</div>

</body>
</html>
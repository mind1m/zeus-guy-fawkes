<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>Game</title>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>


    <script src="jgestures.min.js"  type="text/javascript"></script>
    <script src="http://code.jquery.com/mobile/1.0a3/jquery.mobile-1.0a3.min.js"></script>
    <link rel="stylesheet" type="text/css" href="controls.css" />
    <script type="text/javascript" src="controls.js"></script>
    <script type="text/javascript" src="additional.js"></script>
    <script type="text/javascript" src="classes.js"></script>
    <script type="text/javascript" src="createObjects.js"></script>
    <script type="text/javascript" src="draw.js"></script>

    <meta name="viewport" content="user-scalable=no" />

    <style>
        html,body{
            min-height:100%;
            height:100%;
        }

        body{
            padding:0px;
            margin:0px;
            text-align:center;
        }

       /* .partOfBackground{
            width:32px;
            height:32px;
            background-color: #adff2f !important;
            display: inline-block;
        }

        .partOfBackground{
            -webkit-transition: all 0.5s ease;
            -moz-transition: all 0.5s ease;
            -o-transition: all 0.5s ease;
            -ms-transition: all 0.5s ease;
            transition: all 0.5s ease;
        }*/





    </style>

    <script>

        function resize(){
            var element;
            body_height =  window.innerHeight;
            body_width = window.innerWidth;

            max_size = Math.min(body_height,body_width)

            summary_div_heigth = max_size * 0.9;
            div_height = summary_div_heigth/numberOfTiles;

            sizeOfTile = div_height;
            //alert(sizeOfTile);
            sizeOfMap = summary_div_heigth;

            //Background
            var backgroundDiv = document.getElementById("background");
            backgroundDiv.innerHTML = "";
            document.getElementById("field").appendChild(backgroundDiv);
            for (var i = 0; i < backGround.length; ++i) {
                element = document.createElement('div');
                element.setAttribute('class', 'partOfBackground');
                element.setAttribute('id', i.toString());
                element.style.position = "absolute";
                element.style.left = backGround[i].getX()*sizeOfTile+ "px";
                element.style.top = backGround[i].getY()*sizeOfTile + "px";
                element.style.width = sizeOfTile + "px";
                element.style.height = sizeOfTile + "px";
                element.style.backgroundImage = backgroundImage;
                element.style.backgroundRepeat = "no-repeat";
                element.style.backgroundSize = "100% 100%";
                backgroundDiv.appendChild(element);
            }

            //Blocks
            var blocksDiv = document.getElementById("blocks");
            blocksDiv.innerHTML = "";
            for (var i = 0; i < blocks.length; ++i) {
                element = document.createElement('div');
                element.setAttribute('class', 'block');
                element.setAttribute('id', i.toString());
                element.style.position = "absolute";
                element.style.left = blocks[i].getX()*sizeOfTile+ "px";
                element.style.top = blocks[i].getY()*sizeOfTile + "px";
                element.style.width = sizeOfTile + "px";
                element.style.height = sizeOfTile + "px";
                element.style.backgroundImage = blockImage;
                element.style.backgroundRepeat = "no-repeat";
                element.style.backgroundSize = "100% 100%";
                blocksDiv.appendChild(element);
            }

            //Boxes
            var boxDiv = document.getElementById("boxes");
            boxDiv.innerHTML = "";
            for (var i = 0; i < boxes.length; ++i) {
                id = getRandomInt(1,1000);
                boxes[i].id = id;
                element = document.createElement('div');
                element.setAttribute('class', 'box');
                element.setAttribute('id', "box_"+id.toString());
                element.style.position = "absolute";
                element.style.left = boxes[i].getX()*sizeOfTile+ "px";
                element.style.top = boxes[i].getY()*sizeOfTile + "px";
                element.style.width = sizeOfTile + "px";
                element.style.height = sizeOfTile + "px";
                element.style.backgroundImage = boxImage;
                element.style.zIndex = boxIndex;
                element.style.backgroundRepeat = "no-repeat";
                element.style.backgroundSize = "100% 100%";
                boxDiv.appendChild(element);
            }
            //Player
            var playerDiv = document.getElementById("player");
            playerDiv.style.width = sizeOfTile + "px";
            playerDiv.style.height = sizeOfTile + "px";

            //alert(div_height);
            //$('div.partOfBackground').css('height', div_height);
           //$('div.partOfBackground').css('width', div_height);

            //Creating an objects
            //createObjects(backGround, blocks, player, boxes);

            //Main loop


        }

        window.onload = function() {
            resize();
        };

        window.onresize = function() {
            resize();
        };

    </script>

</head>


<body>
<script type="text/javascript">
    var i, j ,k;
    var bombsCounter = 0;
    firesCounter = 0;

    //Main field
    var element = document.createElement('div');
    element.setAttribute('id', 'field');
    element.style.position = "absolute";
    element.style.left = "0px";
    element.style.top = "0px";
    document.body.appendChild(element);

    //Bombs
    element = document.createElement('div');
    element.setAttribute('id', 'bombs');
    element.style.position = "absolute";
    element.style.left = "0px";
    element.style.top = "0px";
    document.getElementById("field").appendChild(element);

    //Background of the field

    var backGround = new Array();
    for (i = 0; i < numberOfTiles; ++i) {
        for (j = 0; j < numberOfTiles; ++j) {
            backGround.push(new BackgroundTile(i,j));
        }
    }


    //Block of the field
    var blocks = new Array();
    for (k = 0; k < 5; ++k) {
        i = getRandomInt(0, (sizeOfMap - sizeOfTile)/sizeOfTile);
        j = getRandomInt(0, (sizeOfMap - sizeOfTile)/sizeOfTile);
        blocks.push(new Block(i, j));
    }
    //Box
    var boxes = new Array();
    for (k = 0; k < 10; ++k) {
        i = getRandomInt(0, (sizeOfMap - sizeOfTile)/sizeOfTile);
        j = getRandomInt(0, (sizeOfMap - sizeOfTile)/sizeOfTile);
        boxes.push(new Box(i, j));
    }

    //Player
    var player = new Player(0, 0);

    //Bombs
    var bombs = new Array();

    var fires = new Array();

    //Creating an objects
    createObjects(backGround, blocks, player, boxes);

    //Main loop
    setInterval(function() {
        //clearDOM();
        //update(bombs);
        draw(player, bombs, fires);

    }, 200);


    $(document).ready(function() {
        jQuery('.left').bind('tapone',function(){
            goTo('left', 20, player);
        });

        jQuery('.right').bind('tapone',function(){
            goTo('right', 20, player);
        });

        jQuery('.top').bind('tapone',function(){
            goTo('top', 20, player);
        });

        jQuery('.bottom').bind('tapone',function(){
            goTo('bottom', 20, player);
        });
        jQuery('.bomb_creation').bind('click',function(){
            putBomb(bombs, player.getX(),player.getY(), ++bombsCounter, ++firesCounter)
        });
        //    jQuery(".partOfBackground").click(function() {
        //var contentPanelId = jQuery(this).attr("id");
        //alert(contentPanelId);
        //       var playerPos = jQuery("#player").position();
        //alert(playerPos.top + ', ' + playerPos.left);

        //       var pos = jQuery(this).position();
        //alert(pos.top + ', ' + pos.left);

        //     $("#player").animate({'top': pos.top + 'px', 'left': pos.left + 'px' }, "slow");

        //     });


        //var p = $("p:first");
        //var position = currentId.position();

        // var pos = jQuery(currentId).position();
        //alert(pos.top + ', ' + pos.left);


        //$("p:last").text( "left: " + position.left + ", top: " + position.top );


    })
</script>
<div id="controls">
    <span class="left"></span>
    <span class="top"></span>
    <span class="bottom" ></span>
    <span class="right"></span>
</div>
<div style="position: absolute; top: 400px;">
    <input class="bomb_creation" type="button" value="Bomb">
</div>


</body>

</html>